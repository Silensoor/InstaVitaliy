<div *ngIf="isPostsLoaded && isUserDataLoaded" class="index-page" >
  <mat-card class="post-card" *ngFor="let post of posts; let i = index">
    <div class="card-header">
      <div class="title-caption" style="justify-content: flex-start">
        <img class="profile-image"
             [src]="formatImage(post.imagePerson)||'https://www.missingdogsuk.co.uk/wp-content/plugins/wp-job-manager-resumes/assets/images/candidate.png'"
             alt="post image">
        <div class="caption-title">
          <mat-card-title >Title: {{post.title}}</mat-card-title>
          <mat-card-content >Name: {{post.caption}} </mat-card-content>
        </div>
      </div>
      <mat-card-subtitle class="location">Location: {{post.location}}</mat-card-subtitle>

      <img mat-card-image style="height: 100%; width: 100%"
           [src]="formatImage(post.image)||'https://www.missingdogsuk.co.uk/wp-content/plugins/wp-job-manager-resumes/assets/images/candidate.png'"
           alt="post image">
    </div>
    <mat-card-subtitle align="start" class="poster">Posted by {{post.username}}</mat-card-subtitle>
    <div class="like-button">
      <button mat-button (click)="likePost(post.id!, i)"
              [ngClass]="post.usersLiked?.indexOf(user.username) !== -1 ? 'is-liked' : 'not-liked'">
        <mat-icon>favorite</mat-icon>
        Like {{post.likes}}
      </button>

    </div>
    <div *ngIf="post.comments">
      <div class="comments-section" *ngIf="showAllComments[i]">
        <p *ngFor="let comment of post.comments!"><span
          style="font-weight: 500">{{comment.username}}</span>: {{comment.message}}</p>
      </div>
      <div class="comments-section" *ngIf="!showAllComments[i]">
        <p *ngFor="let comment of post.comments!.slice(-3)"><span
          style="font-weight: 500">{{comment.username}}</span>: {{comment.message}}</p>
      </div>
      <button mat-button *ngIf="post.comments.length > 3" (click)="showAllComments[i] = !showAllComments[i]">
        {{showAllComments[i] ? 'Close' : 'Show more'}}
      </button>
    </div>
    <mat-form-field class="w-100">
      <mat-label>Leave a comment...</mat-label>
      <input [(ngModel)]="commentText[i]" (keyup.enter)="postComment(commentText[i], post.id||1, i); commentText[i]=''"
             matInput #message maxlength="128">
      <mat-hint align="end">{{message?.value?.length || 0}} / 128</mat-hint>
    </mat-form-field>
  </mat-card>
</div>
